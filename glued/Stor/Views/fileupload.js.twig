
<script nonce="{{ csp_nonce.script_src }}" type="text/javascript">
  
  // Show modal
  $('#storFileUpload').on('show.bs.modal', function (event) {
    // Button that triggered the modal
    var button = $(event.relatedTarget)
    // Extract info from data-* attributes
    var id = button.data('id')
    var module = button.data('module')
    var modal = $(this)
    // Update the modal's content.
    modal.find('#for_module').text(module)
    modal.find('#for_id').text(id)
    modal.find('#cil_hidden_dir').val(module + '/' + id)
    // tady musime dat aktualni adresu aby se to tam vratilo
    modal.find('#cil_return_url').val('{{ url_for("stor.browser") }}')
    modal.find('.modal-dialog form').attr('action', '{{ url_for("stor.uploader") }}')
  });
  
  // ajax upload
  $('#storFileUpload #ajax-upload').on('click', function (event) {
        //alert("dir " + $('#storFileUpload #cil_hidden_dir').val())
        //var formData = new FormData();
        //formData.append('file', $('#storFileUpload #ajax-file')[0].files[0]);
        //formData.append('actual_dir', 'sobota');
        
        // insert complete form into FormData object
        var formData = new FormData(document.getElementById("storFileUploadForm"));
        
        $.ajax({
               url : '{{ url_for("stor.api.uploader") }}',
               type : 'POST',
               data : formData,
               processData: false,  // tell jQuery not to process the data
               contentType: false,  // tell jQuery not to set contentType
               success : function(retData) {
                    $('#storFileUpload').modal('toggle');
                    console.log(retData);
                    $('#toast-placeholder').empty();
                    $(Twig.twig({ ref: 'toasts' }).render({ title: '{{ __("Stor uploader") }}' , msg: '{{ __("file uploaded") }}' })).appendTo("#toast-placeholder");
                    $('.toast').toast('show');
                    //alert(retData.data.message);
               }
        });
        
  });
  
</script>
